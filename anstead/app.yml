---
- import_playbook: common.yml
- import_playbook: variable-check.yml
  vars:
    playbook: app.yml

- name: "Laravel: Install LEMP Stack with PHP 7.1"
  hosts: web:&{{ env }}
  become: yes
  roles:
    - { role: ferm, tags: [ferm] }
    - { role: web-user, tags: [web-user] }
    - { role: ssmtp, tags: [ssmtp, mail] }
    - { role: php, tags: [php] }
    - { role: supervisor, tags: [supervisor] }
    - { role: nginx, tags: [nginx] }
    - { role: logrotate, tags: [logrotate] }
    - { role: composer, tags: [composer] }
    - { role: letsencrypt, tags: [letsencrypt], when: apps_using_letsencrypt | count }
    - { role: laravel-setup-code, tags: [laravel, laravel-setup-code] }